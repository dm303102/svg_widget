<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG Preview Widget</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .controls { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
    .controls label { flex: 1 1 120px; white-space: nowrap; }
    canvas { display: block; margin-top: 1em; border: 1px solid #ccc; }
    #svgList { list-style: none; padding: 0; margin-top: 1em; max-width: 400px; }
    #svgList li { display: flex; align-items: center; justify-content: space-between; padding: 0.3em; border-bottom: 1px solid #eee; cursor: pointer; }
    #svgList li.selected { background: #def; }
    #svgList li:hover { background: #f0f8ff; }
    #svgList .filename { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 0.5em; }
    #svgList .item-controls { display: flex; align-items: center; gap: 0.5em; }
    #svgList input[type="range"] { width: 80px; }
  </style>
</head>
<body>
  <h1>Upload &amp; Preview Your SVGs</h1>

  <div class="controls">
    <label>
      Length:
      <select id="lengthSelect"><option value="">–</option></select>
    </label>
    <label>
      Width:
      <select id="widthSelect"><option value="">–</option></select>
    </label>
    <span id="priceDisplay"></span>
    <button id="renderBtn">Render Canvas</button>
    <button id="toggleOrientation">Switch to Landscape</button>
    <button id="exportBtn">Export (SVG)</button>
  </div>

  <div id="fileInputContainer" style="display:none; margin-top:1em;">
    <input type="file" id="fileInput" accept=".svg" multiple>
  </div>

  <ul id="svgList"></ul>
  <canvas id="mainCanvas"></canvas>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const variants = [
      { length: 4, width: 4, price: 12.00 },
      { length: 4, width: 6, price: 14.00 },
      { length: 4, width: 8, price: 16.00 },
      { length: 4, width: 10, price: 18.00 },
      { length: 4, width: 12, price: 20.00 },
      { length: 6, width: 4, price: 14.00 },
      { length: 6, width: 6, price: 15.00 },
      { length: 6, width: 8, price: 17.00 },
      { length: 6, width: 10, price: 19.00 },
      { length: 6, width: 12, price: 21.00 },
      { length: 8, width: 4, price: 16.00 },
      { length: 8, width: 6, price: 17.00 },
      { length: 8, width: 8, price: 19.00 },
      { length: 8, width: 10, price: 21.00 },
      { length: 8, width: 12, price: 23.00 },
      { length: 10, width: 4, price: 18.00 },
      { length: 10, width: 6, price: 19.00 },
      { length: 10, width: 8, price: 21.00 },
      { length: 10, width: 10, price: 22.00 },
      { length: 10, width: 12, price: 24.00 },
      { length: 12, width: 4, price: 20.00 },
      { length: 12, width: 6, price: 21.00 },
      { length: 12, width: 8, price: 23.00 },
      { length: 12, width: 10, price: 24.00 },
      { length: 12, width: 12, price: 28.00 },
      { length: 14, width: 4, price: 22.00 },
      { length: 14, width: 6, price: 24.00 },
      { length: 14, width: 8, price: 26.00 },
      { length: 14, width: 10, price: 28.00 },
      { length: 14, width: 12, price: 30.00 },
      { length: 16, width: 4, price: 24.00 },
      { length: 16, width: 6, price: 25.00 },
      { length: 16, width: 8, price: 27.00 },
      { length: 16, width: 10, price: 29.00 },
      { length: 16, width: 12, price: 31.00 },
      { length: 18, width: 4, price: 26.00 },
      { length: 18, width: 6, price: 28.00 },
      { length: 18, width: 8, price: 30.00 },
      { length: 18, width: 10, price: 32.00 },
      { length: 18, width: 12, price: 34.00 },
      { length: 20, width: 4, price: 28.00 },
      { length: 20, width: 6, price: 30.00 },
      { length: 20, width: 8, price: 32.00 },
      { length: 20, width: 10, price: 34.00 },
      { length: 20, width: 12, price: 36.00 },
      { length: 22, width: 4, price: 30.00 },
      { length: 22, width: 6, price: 32.00 },
      { length: 22, width: 8, price: 34.00 },
      { length: 22, width: 10, price: 36.00 },
      { length: 22, width: 12, price: 38.00 },
      { length: 24, width: 4, price: 30.00 },
      { length: 24, width: 6, price: 32.00 },
      { length: 24, width: 8, price: 34.00 },
      { length: 24, width: 10, price: 36.00 },
      { length: 24, width: 12, price: 38.00 },
      { length: 26, width: 4, price: 32.00 },
      { length: 26, width: 6, price: 34.00 },
      { length: 26, width: 8, price: 36.00 },
      { length: 26, width: 10, price: 38.00 },
      { length: 26, width: 12, price: 40.00 },
      { length: 28, width: 4, price: 34.00 },
      { length: 28, width: 6, price: 36.00 },
      { length: 28, width: 8, price: 38.00 },
      { length: 28, width: 10, price: 40.00 },
      { length: 28, width: 12, price: 42.00 },
      { length: 30, width: 4, price: 36.00 },
      { length: 30, width: 6, price: 38.00 },
      { length: 30, width: 8, price: 40.00 },
      { length: 30, width: 10, price: 42.00 },
      { length: 30, width: 12, price: 44.00 },
      { length: 32, width: 4, price: 38.00 },
      { length: 32, width: 6, price: 40.00 },
      { length: 32, width: 8, price: 42.00 },
      { length: 32, width: 10, price: 44.00 },
      { length: 32, width: 12, price: 46.00 },
      { length: 34, width: 4, price: 40.00 },
      { length: 34, width: 6, price: 42.00 },
      { length: 34, width: 8, price: 44.00 },
      { length: 34, width: 10, price: 46.00 },
      { length: 34, width: 12, price: 48.00 },
      { length: 36, width: 4, price: 42.00 },
      { length: 36, width: 6, price: 44.00 },
      { length: 36, width: 8, price: 46.00 },
      { length: 36, width: 10, price: 48.00 },
      { length: 36, width: 12, price: 50.00 }
    ];
    
  const lenSel = document.getElementById('lengthSelect');
  const widSel = document.getElementById('widthSelect');
  const priceDisplay = document.getElementById('priceDisplay');
  const renderBtn = document.getElementById('renderBtn');
  const toggleBtn = document.getElementById('toggleOrientation');
  const exportBtn = document.getElementById('exportBtn');
  const fileInputContainer = document.getElementById('fileInputContainer');
  const fileInput = document.getElementById('fileInput');
  const svgList = document.getElementById('svgList');
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');

  let images = [];
  let selectedId = null;
  let dragging = false;
  let cropping = false;
  let cropStart = {};
  let dragOffset = { x: 0, y: 0 };
  let handleCenter = { x: 0, y: 0 };
  const DPI = 96, borderPx = 4;

  function initSelectors() {
    const valid = variants.filter(v => v.price != null);
    const lengths = [...new Set(valid.map(v => v.length))].sort((a, b) => a - b);
    
    lenSel.innerHTML = '<option value="">–</option>';
    lengths.forEach(l => {
      const o = document.createElement('option');
      o.value = l;
      o.textContent = `${l}"`;
      lenSel.append(o);
    });
    lenSel.disabled = false;
    lenSel.addEventListener('change', updatePriceAndCanvas);

     // disable width until a length is chosen
  widSel.innerHTML = '<option value="">–</option>';
  widSel.disabled = true;

  lenSel.addEventListener('change', onLengthChange);
  widSel.addEventListener('change', onWidthChange);    
  }

  function onLengthChange() {
  const L = parseInt(lenSel.value, 10);
  widSel.innerHTML = '<option value="">–</option>';
  widSel.disabled = !L;

  if (L) {
    // only widths for this length
    const widths = variants
      .filter(v => v.length === L && v.price != null)
      .map(v => v.width)
      .sort((a,b)=>a-b);

    widths.forEach(w => {
      const o = document.createElement('option');
      o.value = w;
      o.textContent = `${w}"`;
      widSel.append(o);
    });
  }

   // clear price/file until width picked
  priceDisplay.textContent = '';
  fileInputContainer.style.display = 'none';

function onWidthChange() {
  const L = parseInt(lenSel.value, 10);
  const W = parseInt(widSel.value, 10);
  const v = variants.find(x => x.length === L && x.width === W && x.price != null);

  if (v) {
    priceDisplay.textContent = `Price: $${v.price.toFixed(2)}`;
    fileInputContainer.style.display = 'block';
  } else {
    priceDisplay.textContent = '';
    fileInputContainer.style.display = 'none';
  }
}
    
  function updatePriceAndCanvas() {
    const L = parseInt(lenSel.value, 10);
    const widths = variants.filter(v => v.length === L && v.price != null).map(v => v.width).sort((a, b) => a - b);
    widSel.innerHTML = '<option value="">–</option>';
    widths.forEach(w => {
      const o = document.createElement('option');
      o.value = w;
      o.textContent = `${w}"`;
      widSel.append(o);
    });
    widSel.disabled = false;
    const W = parseInt(widSel.value, 10);
    const v = variants.find(x => x.length === L && x.width === W && x.price != null);
    priceDisplay.textContent = v ? `Price: $${v.price.toFixed(2)}` : '';
    fileInputContainer.style.display = v ? 'block' : 'none';
  }

  function redrawCanvas() {
    const L = parseInt(lenSel.value, 10), W = parseInt(widSel.value, 10);
    if (!(L && W)) { fileInputContainer.style.display = 'none'; return; }
    const wPx = L * DPI, hPx = W * DPI;
    canvas.width = wPx + borderPx * 2;
    canvas.height = hPx + borderPx * 2;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.lineWidth = borderPx;
    ctx.strokeStyle = '#000';
    ctx.strokeRect(borderPx / 2, borderPx / 2, wPx + borderPx, hPx + borderPx);

    ctx.fillStyle = '#000';
    ctx.font = '16px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(`L: ${L}"`, borderPx + 4, canvas.height - 4);
    ctx.textAlign = 'right';
    ctx.fillText(`W: ${W}"`, canvas.width - borderPx - 4, canvas.height - 4);

    images.forEach(it => {
      const dW = it.origW * it.fitScale * it.scalePercent;
      const dH = it.origH * it.fitScale * it.scalePercent;
      if (it.crop) {
        ctx.save();
        ctx.beginPath();
        ctx.rect(it.x + it.crop.x, it.y + it.crop.y, it.crop.w, it.crop.h);
        ctx.clip();
      }
      ctx.drawImage(it.image, it.x, it.y, dW, dH);
      if (it.crop) ctx.restore();

      if (it.id === selectedId) {
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'red';
        ctx.strokeRect(it.x, it.y, dW, dH);
      }
    });
  }

  function updateList() {
    svgList.innerHTML = '';
    images.forEach((it, i) => {
      const li = document.createElement('li');
      li.dataset.id = it.id;
      if (it.id === selectedId) li.classList.add('selected');
      li.textContent = '';

      const name = document.createElement('span');
      name.className = 'filename';
      name.textContent = it.filename || `SVG ${i + 1}`;

      const ctr = document.createElement('div');
      ctr.className = 'item-controls';

      const sl = document.createElement('input');
      sl.type = 'range';
      sl.min = 10;
      sl.max = 200;
      sl.step = 0.1;
      sl.value = (it.scalePercent * 100).toFixed(1);
      sl.dataset.id = it.id;

      const cropBtn = document.createElement('button');
      cropBtn.textContent = 'Crop';
      cropBtn.dataset.id = it.id;

      const dupBtn = document.createElement('button');
      dupBtn.textContent = 'Duplicate';
      dupBtn.dataset.id = it.id;

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.dataset.id = it.id;

      ctr.append(sl, cropBtn, dupBtn, delBtn);
      li.append(name, ctr);
      svgList.append(li);
    });
  }

  function selectImage(id) {
    selectedId = id;
    updateList();
    redrawCanvas();
  }

  svgList.addEventListener('click', e => {
    const li = e.target.closest('li');
    if (!li) return;
    const id = li.dataset.id;

    switch (e.target.textContent) {
      case 'Delete':
        images = images.filter(i => i.id !== id);
        selectedId = images[0]?.id || null;
        updateList();
        redrawCanvas();
        break;
      case 'Crop':
        selectImage(id);
        cropping = true;
        cropStart = { startX: null, startY: null, curX: null, curY: null };
        break;
      case 'Duplicate':
        const orig = images.find(i => i.id === id);
        const clone = Object.assign({}, orig, {
          id: Date.now() + '_' + Math.random(),
          x: orig.x + 10,
          y: orig.y + 10
        });
        if (orig.crop) clone.crop = Object.assign({}, orig.crop);
        images.push(clone);
        selectImage(clone.id);
        break;
      default:
        selectImage(id);
    }
  });

  svgList.addEventListener('input', e => {
    if (e.target.type === 'range') {
      const it = images.find(i => i.id === e.target.dataset.id);
      it.scalePercent = parseFloat(e.target.value) / 100;
      selectImage(it.id);
    }
  });

  renderBtn.addEventListener('click', redrawCanvas);
  toggleBtn.addEventListener('click', () => {
    [lenSel.value, widSel.value] = [widSel.value, lenSel.value];
    updatePriceAndCanvas(); redrawCanvas();
    toggleBtn.textContent = toggleBtn.textContent.includes('Landscape')
      ? 'Switch to Portrait' : 'Switch to Landscape';
  });

  canvas.addEventListener('mousedown', e => {
    const r = canvas.getBoundingClientRect();
    const x = e.clientX - r.left, y = e.clientY - r.top;

    if (cropping) {
      cropStart.startX = x;
      cropStart.startY = y;
      cropStart.curX = x;
      cropStart.curY = y;
      canvas.style.cursor = 'crosshair';
      return;
    }

    for (let i = images.length - 1; i >= 0; i--) {
      const it = images[i];
      const dW = it.origW * it.fitScale * it.scalePercent;
      const dH = it.origH * it.fitScale * it.scalePercent;
      if (x >= it.x && x <= it.x + dW && y >= it.y && y <= it.y + dH) {
        selectImage(it.id);
        break;
      }
    }

    if (!selectedId) return;
    const it = images.find(i => i.id === selectedId);
    const dW = it.origW * it.fitScale * it.scalePercent;
    const dH = it.origH * it.fitScale * it.scalePercent;

    if (x >= it.x && x <= it.x + dW && y >= it.y && y <= it.y + dH) {
      dragging = true; dragOffset = { x: x - it.x, y: y - it.y };
      canvas.style.cursor = 'grabbing';
    }
  });

  canvas.addEventListener('mousemove', e => {
    const r = canvas.getBoundingClientRect();
    const x = e.clientX - r.left, y = e.clientY - r.top;

    if (cropping && cropStart.startX != null) {
      cropStart.curX = x;
      cropStart.curY = y;
      redrawCanvas();
      return;
    }

    if (!dragging && selectedId) {
      const it = images.find(i => i.id === selectedId);
      const dW = it.origW * it.fitScale * it.scalePercent;
      const dH = it.origH * it.fitScale * it.scalePercent;
      canvas.style.cursor =
        (x >= it.x && x <= it.x + dW && y >= it.y && y <= it.y + dH) ? 'grab' : 'default';
    }

    if (dragging) {
      const it = images.find(i => i.id === selectedId);
      it.x = x - dragOffset.x;
      it.y = y - dragOffset.y;
      redrawCanvas();
    }
  });

  ['mouseup','mouseleave'].forEach(ev => canvas.addEventListener(ev, () => {
    if (cropping && cropStart.startX != null) {
      const it = images.find(i => i.id === selectedId);
      const x0 = Math.min(cropStart.startX, cropStart.curX) - it.x;
      const y0 = Math.min(cropStart.startY, cropStart.curY) - it.y;
      const w0 = Math.abs(cropStart.curX - cropStart.startX);
      const h0 = Math.abs(cropStart.curY - cropStart.startY);
      it.crop = { x: x0, y: y0, w: w0, h: h0 };
      cropping = false;
      redrawCanvas();
    }
    dragging = false;
    canvas.style.cursor = 'default';
  }));

  
    exportBtn.addEventListener('click',()=>{
      const L=parseInt(lenSel.value), W=parseInt(widSel.value);
      if(!(L&&W))return;
      const wPx=L*DPI, hPx=W*DPI;
      const xmlns='http://www.w3.org/2000/svg';
      let svg=`<?xml version="1.0" encoding="UTF-8"?><svg xmlns="${xmlns}" width="${wPx+borderPx*2}" height="${hPx+borderPx*2}" viewBox="0 0 ${wPx+borderPx*2} ${hPx+borderPx*2}">`;
      svg+=`<rect x="${borderPx/2}" y="${borderPx/2}" width="${wPx+borderPx}" height="${hPx+borderPx}" fill="none" stroke="black" stroke-width="${borderPx}"/>`;
      svg+=`<text x="${borderPx+4}" y="${hPx+borderPx*2-4}" font-family="sans-serif" font-size="16">L: ${L}"</text>`;
      svg+=`<text x="${wPx+borderPx*2-4}" y="${hPx+borderPx*2-4}" font-family="sans-serif" font-size="16" text-anchor="end">W: ${W}"</text>`;
      images.forEach(itm=>{
        const dW=itm.origW*itm.fitScale*itm.scalePercent;
        const dH=itm.origH*itm.fitScale*itm.scalePercent;
        const inner=new DOMParser().parseFromString(itm.svgText,'image/svg+xml').documentElement.innerHTML;
        svg+=`<svg x="${itm.x}" y="${itm.y}" width="${dW}" height="${dH}" viewBox="0 0 ${itm.origW} ${itm.origH}" xmlns="${xmlns}">${inner}</svg>`;
      });
      svg+='</svg>';
      const blob=new Blob([svg],{type:'image/svg+xml'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');a.href=url;a.download='canvas-export.svg';a.click();URL.revokeObjectURL(url);
    });

  fileInput.addEventListener('change',e=>{
    const L=parseInt(lenSel.value),W=parseInt(widSel.value);
    if(!(L&&W)) return;
    const wPx=L*DPI,hPx=W*DPI;
    Array.from(e.target.files).forEach(file=>{
      const r=new FileReader(); r.onload=ev=>{
        const svgText=ev.target.result;
        const doc=new DOMParser().parseFromString(svgText,'image/svg+xml');
        const svgEl=doc.documentElement;
        const origW=parseFloat(svgEl.getAttribute('width'))||parseFloat(svgEl.getAttribute('viewBox').split(' ')[2]);
        const origH=parseFloat(svgEl.getAttribute('height'))||parseFloat(svgEl.getAttribute('viewBox').split(' ')[3]);
        const fitScale=Math.min(wPx/origW,hPx/origH);
        const dW=origW*fitScale,dH=origH*fitScale;
        const x=borderPx+(wPx-dW)/2,y=borderPx+(hPx-dH)/2;
        const id=Date.now()+'_'+Math.random();
        const img=new Image(); img.onload=()=>{
          images.push({id,filename:file.name,svgText,image:img,origW,origH,fitScale,scalePercent:1,x,y});
          selectImage(id);
        };
        img.src=URL.createObjectURL(new Blob([svgText],{type:'image/svg+xml'}));
      }; r.readAsText(file);
    });
    fileInput.value=''; // allow re-uploading same files
  });
});
</script>
</body>
</html>
