<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG Preview Widget</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .controls label { flex: 1 1 120px; white-space: nowrap; }
    canvas { cursor: default; }
    /* Slider styling inside list */
    .svg-item .scale-slider { width: 80px; margin: 0 0.5em; vertical-align: middle; }
    .svg-item .scale-value { min-width: 30px; display: inline-block; }
  </style>
</head>
<body>
  <h1>Upload &amp; Preview Your SVGs</h1>

  <div class="controls">
    <label>Canvas Width (in): <input type="number" id="widthInput" step="any" placeholder="3.5" /></label>
    <label>Canvas Height (in): <input type="number" id="heightInput" step="any" placeholder="2" /></label>
    <button id="renderBtn">Render Canvas</button>
    <button id="toggleOrientation">Switch to Landscape</button>
    <button id="exportBtn">Export Canvas</button>
    <button id="exportSvgBtn">Export as SVG</button>
  </div>

  <div id="fileInputContainer" style="display:none; margin-top:1em;">
    <input type="file" id="fileInput" accept=".svg" multiple />
  </div>

  <ul id="svgList"></ul>
  <canvas id="mainCanvas"></canvas>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const images = [];
      let selectedId = null;
      let dragging = false;
      let dragOffset = { x: 0, y: 0 };
      let handleCenter = { x: 0, y: 0 };
      const DPI = 96;
      const borderPx = 4;

      const widthInput = document.getElementById('widthInput');
      const heightInput = document.getElementById('heightInput');
      const renderBtn = document.getElementById('renderBtn');
      const toggleOrient = document.getElementById('toggleOrientation');
      const exportBtn = document.getElementById('exportBtn');
      const exportSvgBtn = document.getElementById('exportSvgBtn');
      const fileInputContainer = document.getElementById('fileInputContainer');
      const fileInput = document.getElementById('fileInput');
      const svgList = document.getElementById('svgList');
      const canvas = document.getElementById('mainCanvas');
      const ctx = canvas.getContext('2d');

      function redrawAll() {
        const wIn = parseFloat(widthInput.value);
        const hIn = parseFloat(heightInput.value);
        if (!(wIn > 0 && hIn > 0)) {
          fileInputContainer.style.display = 'none';
          return;
        }
        fileInputContainer.style.display = 'block';
        const wPx = Math.round(wIn * DPI);
        const hPx = Math.round(hIn * DPI);
        canvas.width = wPx + borderPx * 2;
        canvas.height = hPx + borderPx * 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.lineWidth = borderPx; ctx.strokeStyle = '#000';
        ctx.strokeRect(borderPx/2, borderPx/2, wPx + borderPx, hPx + borderPx);

        ctx.fillStyle = '#000'; ctx.font = '16px sans-serif'; ctx.textAlign = 'left';
        ctx.fillText(`W: ${wIn}\"`, borderPx + 4, canvas.height - 4);
        ctx.textAlign = 'right';
        ctx.fillText(`H: ${hIn}\"`, canvas.width - borderPx - 4, canvas.height - 4);

        images.forEach(item => {
          const drawW = item.origW * item.fitScale * item.scalePercent;
          const drawH = item.origH * item.fitScale * item.scalePercent;
          ctx.drawImage(item.image, item.x, item.y, drawW, drawH);
        });
        if (selectedId) {
          const item = images.find(i => i.id === selectedId);
          const drawW = item.origW * item.fitScale * item.scalePercent;
          const drawH = item.origH * item.fitScale * item.scalePercent;
          ctx.lineWidth = 2; ctx.strokeStyle = 'red';
          ctx.strokeRect(item.x, item.y, drawW, drawH);
          handleCenter.x = item.x + drawW/2;
          handleCenter.y = item.y - 12;
          ctx.beginPath(); ctx.arc(handleCenter.x, handleCenter.y, 8, 0, 2*Math.PI);
          ctx.fillStyle = '#3498db'; ctx.fill(); ctx.lineWidth = 2; ctx.strokeStyle = '#fff'; ctx.stroke();
        }
      }

      function updateList() {
        svgList.innerHTML = '';
        images.forEach((item, index) => {
          const li = document.createElement('li');
          li.className = 'svg-item';
          li.dataset.id = item.id;
          if (item.id === selectedId) li.classList.add('selected');
          li.innerHTML = `
            SVG ${index+1}
            <button class="moveBtn" data-id="${item.id}">Move</button>
            <input type="range" class="scale-slider" data-id="${item.id}" min="10" max="200" value="${item.scalePercent*100}" />
            <span class="scale-value" data-id="${item.id}">${Math.round(item.scalePercent*100)}%</span>
            <button class="deleteBtn" data-id="${item.id}">Delete</button>
          `;
          svgList.appendChild(li);
        });
      }

      function selectImage(id) {
        selectedId = id; updateList(); redrawAll();
      }

      svgList.addEventListener('input', e => {
        if (e.target.matches('.scale-slider')) {
          const id = e.target.dataset.id;
          const value = parseFloat(e.target.value);
          const item = images.find(i => i.id === id);
          item.scalePercent = value / 100;
          document.querySelector(`.scale-value[data-id=\"${id}\"]`).textContent = `${value}%`;
          redrawAll();
        }
      });

      svgList.addEventListener('click', e => {
        const id = e.target.dataset.id;
        if (e.target.matches('.deleteBtn')) {
          images.splice(images.findIndex(i => i.id === id), 1);
          selectedId = images[0]?.id || null;
          updateList(); redrawAll(); return;
        }
        if (e.target.matches('.moveBtn')) {
          selectImage(id); return;
        }
        const li = e.target.closest('li'); if (li) selectImage(li.dataset.id);
      });

      renderBtn.addEventListener('click', redrawAll);

      toggleOrient.addEventListener('click', () => {
        [widthInput.value, heightInput.value] = [heightInput.value, widthInput.value];
        toggleOrient.textContent = toggleOrient.textContent.includes('Landscape') ? 'Switch to Portrait' : 'Switch to Landscape';
        const wIn = parseFloat(widthInput.value), hIn = parseFloat(heightInput.value);
        const wPx = Math.round(wIn * DPI), hPx = Math.round(hIn * DPI);
        images.forEach(item => {
          item.fitScale = Math.min(wPx/item.origW, hPx/item.origH);
          const drawW = item.origW * item.fitScale * item.scalePercent;
          const drawH = item.origH * item.fitScale * item.scalePercent;
          item.x = borderPx + (wPx - drawW)/2;
          item.y = borderPx + (hPx - drawH)/2;
        }); redrawAll();
      });

      canvas.addEventListener('mousedown', e => {
        if (!selectedId) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left, y = e.clientY - rect.top;
        const dx = x - handleCenter.x, dy = y - handleCenter.y;
        if (Math.hypot(dx, dy) <= 8) {
          dragging = true;
          const item = images.find(i => i.id === selectedId);
          dragOffset.x = x - item.x;
          dragOffset.y = y - item.y;
          canvas.style.cursor = 'grabbing';
        }
      });
      canvas.addEventListener('mousemove', e => {
        if (dragging) {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left, y = e.clientY - rect.top;
          const item = images.find(i => i.id === selectedId);
          item.x = x - dragOffset.x;
          item.y = y - dragOffset.y;
          redrawAll();
        }
      });
      ['mouseup','mouseleave'].forEach(ev => canvas.addEventListener(ev, () => { dragging = false; canvas.style.cursor = 'default'; }));

      exportBtn.addEventListener('click', () => {
        const link
